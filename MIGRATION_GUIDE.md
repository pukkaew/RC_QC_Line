# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏ô‡∏Å‡∏±‡∏ô (Migration Guide)

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°:**
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠ upload ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢ Lot ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏õ‡∏ô‡∏Å‡∏±‡∏ô
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: Upload Lot "ABC123" ‡πÄ‡∏ä‡πâ‡∏≤ 5 ‡∏£‡∏π‡∏õ, ‡∏ö‡πà‡∏≤‡∏¢ 10 ‡∏£‡∏π‡∏õ ‚Üí ‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏π‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô 15 ‡∏£‡∏π‡∏õ

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- Database ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÅ‡∏¢‡∏Å session ‡∏Å‡∏≤‡∏£ upload
- Query ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ Lot ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏±‡∏ô

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå `upload_session_id` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Images
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà upload ‡∏à‡∏∞‡∏°‡∏µ session_id ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å migrate ‡πÇ‡∏î‡∏¢‡πÅ‡∏¢‡∏Å session ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô > 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á = ‡∏Ñ‡∏ô‡∏•‡∏∞ session)

---

## üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Migrate (‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (BACKUP) ‚ö†Ô∏è

```sql
-- Run ‡πÉ‡∏ô SQL Server Management Studio
USE [RC_QC_Line]
GO

-- Backup Images table
SELECT * INTO Images_Backup_20251031
FROM Images;

-- Verify backup
SELECT COUNT(*) as original_count FROM Images;
SELECT COUNT(*) as backup_count FROM Images_Backup_20251031;
```

**‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° Column ‡πÅ‡∏•‡∏∞ Migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```bash
# ‡πÄ‡∏õ‡∏¥‡∏î SQL Server Management Studio
# ‡πÑ‡∏õ‡∏ó‡∏µ‡πà RC_QC_Line database
# ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå: migration_add_session_id.sql
# ‡∏Å‡∏î Execute (F5)
```

**Script ‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:**
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° column `upload_session_id BIGINT NULL`
2. Migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÇ‡∏î‡∏¢‡πÅ‡∏¢‡∏Å session ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:
   - ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà upload ‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô < 1 ‡∏ä‡∏°. = session ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
   - ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà upload ‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô > 1 ‡∏ä‡∏°. = ‡∏Ñ‡∏ô‡∏•‡∏∞ session
3. ‡∏™‡∏£‡πâ‡∏≤‡∏á index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Output ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:**
```
Migration completed!
Records with session_id: 150
Records without session_id: 0
```

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: Update Stored Procedures

```bash
# ‡πÄ‡∏õ‡∏¥‡∏î SQL Server Management Studio
# ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå: update_stored_procedures.sql
# ‡∏Å‡∏î Execute (F5)
```

**Script ‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:**
1. ‡∏•‡∏ö stored procedures ‡πÄ‡∏Å‡πà‡∏≤
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á procedures ‡πÉ‡∏´‡∏°‡πà:
   - `sp_GetSessionsByLotAndDate` - ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏µ‡πà session
   - `sp_GetImagesByLotAndDateAndSession` - ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏ï‡∏≤‡∏° session
   - `sp_GetImagesByLotAndDate` (updated) - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤
   - `sp_UploadImage` (updated) - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö session_id

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Output ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:**
```
Stored procedures updated successfully!

New procedures created:
  - sp_GetSessionsByLotAndDate (NEW)
  - sp_GetImagesByLotAndDateAndSession (NEW)
  ...
```

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: Deploy ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà

```bash
# ‡∏ö‡∏ô server ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô

# 1. Pull code ‡πÉ‡∏´‡∏°‡πà
cd /path/to/RC_QC_Line
git pull origin claude/check-code-status-011CUec6DnkJr74HUjq8mZ51

# 2. Restart application
npm restart
# ‡∏´‡∏£‡∏∑‡∏≠
pm2 restart rc_qc_line
```

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö

#### 5.1 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Upload ‡πÉ‡∏´‡∏°‡πà

1. ‡πÄ‡∏õ‡∏¥‡∏î LINE ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó
2. ‡∏û‡∏¥‡∏°‡∏û‡πå `#up TEST001`
3. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ 3 ‡∏£‡∏π‡∏õ
4. ‡∏£‡∏≠‡∏à‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
5. ‡∏û‡∏¥‡∏°‡∏û‡πå `#up TEST001` ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Lot ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô!)
6. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ 2 ‡∏£‡∏π‡∏õ‡∏≠‡∏µ‡∏Å
7. ‡∏£‡∏≠‡∏à‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 3 ‡∏£‡∏π‡∏õ
- ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 2 ‡∏£‡∏π‡∏õ (‡∏Ñ‡∏ô‡∏•‡∏∞ session)

#### 5.2 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏π‡∏£‡∏π‡∏õ

```
‡∏û‡∏¥‡∏°‡∏û‡πå: #view TEST001
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:**
- ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏π‡∏õ session ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (2 ‡∏£‡∏π‡∏õ)
- **‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏π‡∏õ session ‡πÅ‡∏£‡∏Å (3 ‡∏£‡∏π‡∏õ) ‡∏õ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤** ‚úÖ

#### 5.3 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Database

```sql
-- ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ session ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Lot TEST001
EXEC sp_GetSessionsByLotAndDate
  @LotNumber = 'TEST001',
  @ImageDate = '2025-10-31';

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á 2 sessions:
-- Session 1: 3 images (‡πÄ‡∏ä‡πâ‡∏≤)
-- Session 2: 2 images (‡∏ö‡πà‡∏≤‡∏¢)
```

---

## üîÑ ‡∏Å‡∏≤‡∏£ Rollback (‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤)

‚ö†Ô∏è **‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ migration ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß**

```bash
# ‡πÄ‡∏õ‡∏¥‡∏î SQL Server Management Studio
# ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå: migration_rollback.sql
# ‡∏Å‡∏î Execute (F5)

# Restore ‡∏à‡∏≤‡∏Å backup
USE [RC_QC_Line]
GO

DROP TABLE Images;
GO

SELECT * INTO Images
FROM Images_Backup_20251031;
GO

# Revert code
git checkout HEAD~1
npm restart
```

---

## üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Å‡πà‡∏≠‡∏ô Migration

```sql
-- ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á Lot ABC123 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 31 ‡∏ï.‡∏Ñ.
SELECT * FROM Images i
JOIN Lots l ON i.lot_id = l.lot_id
WHERE l.lot_number = 'ABC123'
  AND CONVERT(DATE, i.image_date) = '2025-10-31'
ORDER BY uploaded_at;

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 15 ‡∏£‡∏π‡∏õ (5 + 10) ‡∏õ‡∏ô‡∏Å‡∏±‡∏ô
```

### ‡∏´‡∏•‡∏±‡∏á Migration

```sql
-- ‡∏î‡∏π sessions ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
EXEC sp_GetSessionsByLotAndDate
  @LotNumber = 'ABC123',
  @ImageDate = '2025-10-31';

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÅ‡∏™‡∏î‡∏á 2 sessions
-- Session 1: 09:00, 5 images
-- Session 2: 14:00, 10 images

-- ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á session ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
EXEC sp_GetImagesByLotAndDateAndSession
  @LotNumber = 'ABC123',
  @ImageDate = '2025-10-31',
  @SessionId = NULL;  -- NULL = latest session

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 10 ‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á session ‡∏ó‡∏µ‡πà 2 (14:00)
```

---

## ‚úÖ Checklist

- [ ] ‡∏™‡∏≥‡∏£‡∏≠‡∏á database ‡πÅ‡∏•‡πâ‡∏ß
- [ ] ‡∏£‡∏±‡∏ô `migration_add_session_id.sql` ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- [ ] ‡∏£‡∏±‡∏ô `update_stored_procedures.sql` ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- [ ] Verify: `SELECT COUNT(*) FROM Images WHERE upload_session_id IS NOT NULL` = ‡∏ó‡∏∏‡∏Å record
- [ ] Deploy code ‡πÉ‡∏´‡∏°‡πà
- [ ] Restart application
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö upload 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Lot ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏π‡∏£‡∏π‡∏õ ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ session ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö log ‡πÑ‡∏°‡πà‡∏°‡∏µ error

---

## üÜò Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Migration script error

```sql
-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ column ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
SELECT * FROM sys.columns
WHERE object_id = OBJECT_ID(N'[dbo].[Images]')
AND name = 'upload_session_id';

-- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ: Skip migration, ‡πÑ‡∏õ‡∏ó‡∏≥ update stored procedures
-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ: ‡∏•‡∏≠‡∏á run migration ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
```

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Application error ‡∏´‡∏•‡∏±‡∏á deploy

```bash
# ‡∏î‡∏π log
tail -f logs/error.log

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ database connection ‡∏õ‡∏Å‡∏ï‡∏¥
# Restart application
pm2 restart rc_qc_line
```

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏¢‡∏±‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏õ‡∏ô‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà

```sql
-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ stored procedure update ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
SELECT OBJECT_DEFINITION(OBJECT_ID('sp_GetImagesByLotAndDate'));

-- ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô: EXEC [dbo].[sp_GetImagesByLotAndDateAndSession]
-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô: ‡∏£‡∏±‡∏ô update_stored_procedures.sql ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
```

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

1. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢**: Migration ‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ ‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° column ‡πÉ‡∏´‡∏°‡πà
2. **Backward Compatible**: ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ `upload_session_id` ‡πÄ‡∏õ‡πá‡∏ô NULL ‡πÑ‡∏î‡πâ
3. **Performance**: ‡πÄ‡∏û‡∏¥‡πà‡∏° index ‡πÅ‡∏•‡πâ‡∏ß query ‡∏à‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
4. **Future Uploads**: ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏á migration ‡∏à‡∏∞‡∏°‡∏µ session_id ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤
